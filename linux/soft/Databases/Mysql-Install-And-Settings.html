<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL 安装和配置 | Linux_All_in_one</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/Linux_All_in_one/favicon.ico">
    <meta name="description" content="Linux 运维、软件运维、Docker 教程、网络安全">
    
    <link rel="preload" href="/Linux_All_in_one/assets/css/0.styles.407428ab.css" as="style"><link rel="preload" href="/Linux_All_in_one/assets/js/app.4a61619a.js" as="script"><link rel="preload" href="/Linux_All_in_one/assets/js/2.ee3c5eb7.js" as="script"><link rel="preload" href="/Linux_All_in_one/assets/js/1.bc260717.js" as="script"><link rel="preload" href="/Linux_All_in_one/assets/js/79.48030292.js" as="script"><link rel="preload" href="/Linux_All_in_one/assets/js/21.f8578145.js" as="script"><link rel="prefetch" href="/Linux_All_in_one/assets/js/100.5e0212b4.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/101.280ba6c4.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/102.fcbe69ef.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/103.59b3bf86.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/104.628bb6be.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/105.f6a0a62b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/106.53648c35.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/107.093c4fab.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/108.f8895b2f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/109.878b5e6d.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/110.e7dbd5ce.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/12.4bdd7f50.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/13.4850c8c8.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/14.66e24ed5.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/15.41d57e79.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/16.96600c16.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/17.1cd68a21.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/18.f54ebd77.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/19.36d25975.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/20.0120ca8c.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/22.9efa850b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/23.d7f5441c.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/24.1cabd94c.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/25.2cb5712a.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/26.440ab754.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/27.94e60af2.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/28.f1611369.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/29.730dead3.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/3.accc0318.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/30.f69c3378.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/31.be2478fc.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/32.9465ce70.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/33.f4c85e8a.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/34.c3a0ece1.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/35.a75dd538.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/36.da0b8594.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/37.c49eb234.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/38.16f7d0e5.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/39.ba6e47f0.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/4.9736648b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/40.664ddb58.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/41.4189f6ca.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/42.6472b832.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/43.c8d06688.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/44.e39a047e.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/45.39945860.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/46.ccbd9cdc.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/47.9bed3a75.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/48.05ecd397.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/49.4f2f2874.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/5.9a4eb5c9.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/50.d01632db.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/51.ad40e5f5.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/52.bfacfa08.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/53.9398692c.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/54.b34cb199.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/55.6735c148.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/56.575312d7.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/57.d54f0ac7.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/58.f3cc4cf5.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/59.881dba8f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/6.a3475002.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/60.859faf8a.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/61.4efca474.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/62.578a9742.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/63.95e6ff4f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/64.054ab297.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/65.5be33d9b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/66.2312529e.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/67.81dd084d.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/68.a11966f3.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/69.ffbf7d57.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/7.b4d90be9.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/70.51883659.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/71.9ff55cae.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/72.d54e184f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/73.5062fbf7.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/74.0721cccd.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/75.42dd3581.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/76.d590fa57.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/77.0e5953f3.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/78.4bb79720.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/80.d036bc22.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/81.d6524746.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/82.93460687.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/83.7c6f2e4a.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/84.83b1808d.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/85.14c12ffc.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/86.893b5c41.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/87.7d10879f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/88.ef12068f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/89.cc81e4e4.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/90.130454fc.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/91.838da398.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/92.22813cd9.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/93.2000427b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/94.062717c8.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/95.9cc81974.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/96.0457546b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/97.71d6bbd5.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/98.e6299973.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/99.b198a395.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/vendors~docsearch.00f0a528.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/vendors~flowchart.d07b8b19.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/vendors~notification.877bb3fc.js">
    <link rel="stylesheet" href="/Linux_All_in_one/assets/css/0.styles.407428ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Linux_All_in_one/" class="home-link router-link-active"><img src="/Linux_All_in_one/images/dunwu-logo-100.png" alt="Linux_All_in_one" class="logo"> <span class="site-name can-hide">Linux_All_in_one</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Linux_All_in_one/linux/cli/" class="nav-link">
  💻 Linux 命令
</a></div><div class="nav-item"><a href="/Linux_All_in_one/linux/ops/" class="nav-link">
  ⚙️ Linux 运维
</a></div><div class="nav-item"><a href="/Linux_All_in_one/linux/soft/" class="nav-link router-link-active">
  📦 Linux 软件运维
</a></div><div class="nav-item"><a href="/Linux_All_in_one/docker/" class="nav-link">
  🐳 Docker 教程
</a></div><div class="nav-item"><a href="/Linux_All_in_one/Cybersecurity/" class="nav-link">
  🔒 Linux与网络安全
</a></div> <a href="https://github.com/adminlove520/Linux_All_in_one" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Linux_All_in_one/linux/cli/" class="nav-link">
  💻 Linux 命令
</a></div><div class="nav-item"><a href="/Linux_All_in_one/linux/ops/" class="nav-link">
  ⚙️ Linux 运维
</a></div><div class="nav-item"><a href="/Linux_All_in_one/linux/soft/" class="nav-link router-link-active">
  📦 Linux 软件运维
</a></div><div class="nav-item"><a href="/Linux_All_in_one/docker/" class="nav-link">
  🐳 Docker 教程
</a></div><div class="nav-item"><a href="/Linux_All_in_one/Cybersecurity/" class="nav-link">
  🔒 Linux与网络安全
</a></div> <a href="https://github.com/adminlove520/Linux_All_in_one" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MySQL 安装和配置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#docker-安装-mysql-不带挂载" class="sidebar-link">Docker 安装 MySQL（不带挂载）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#docker-安装-mysql-带挂载" class="sidebar-link">Docker 安装 MySQL（带挂载）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#mysql-5-5-安装" class="sidebar-link">MySQL 5.5 安装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#mysql-5-6-安装" class="sidebar-link">MySQL 5.6 安装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#mysql-5-7-yum-安装" class="sidebar-link">MySQL 5.7 YUM 安装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#mysql-配置" class="sidebar-link">MySQL 配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#修改-root-账号密码" class="sidebar-link">修改 root 账号密码</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#连接报错-host-192-168-1-133-is-not-allowed-to-connect-to-this-mysql-server" class="sidebar-link">连接报错：&quot;Host '192.168.1.133' is not allowed to connect to this MySQL server&quot;</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#修改密码报错-your-password-does-not-satisfy-the-current-policy-requirements" class="sidebar-link">修改密码报错：Your password does not satisfy the current policy requirements</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#mysql-5-7" class="sidebar-link">MySQL 5.7</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#小内存机子-mysql-频繁挂掉解决办法-1g-centos-7-4" class="sidebar-link">小内存机子，MySQL 频繁挂掉解决办法（1G + CentOS 7.4）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#mysql-主从复制" class="sidebar-link">MySQL 主从复制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#环境说明和注意点" class="sidebar-link">环境说明和注意点</a></li><li class="sidebar-sub-header"><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#主库机子操作" class="sidebar-link">主库机子操作</a></li><li class="sidebar-sub-header"><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#从库机子操作" class="sidebar-link">从库机子操作</a></li></ul></li><li><a href="/Linux_All_in_one/linux/soft/Databases/Mysql-Install-And-Settings.html#资料" class="sidebar-link">资料</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql-安装和配置"><a href="#mysql-安装和配置" class="header-anchor">#</a> MySQL 安装和配置</h1> <h2 id="docker-安装-mysql-不带挂载"><a href="#docker-安装-mysql-不带挂载" class="header-anchor">#</a> Docker 安装 MySQL（不带挂载）</h2> <div class="language- extra-class"><pre class="language-text"><code>docker run \
	--name mysql-jira \
	--restart always \
	-p 3306:3306 \
	-e MYSQL_ROOT_PASSWORD=adg_123456 \
	-e MYSQL_DATABASE=jira_db \
	-e MYSQL_USER=jira_user \
	-e MYSQL_PASSWORD=jira_123456 \
	-d \
	mysql:5.7
</code></pre></div><ul><li>连上容器：<code>docker exec -it mysql-jira /bin/bash</code> <ul><li>连上 MySQL：<code>mysql -u root -p</code></li></ul></li> <li>设置编码：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>SET NAMES 'utf8mb4';
alter database jira_db character set utf8mb4;
</code></pre></div><h2 id="docker-安装-mysql-带挂载"><a href="#docker-安装-mysql-带挂载" class="header-anchor">#</a> Docker 安装 MySQL（带挂载）</h2> <ul><li>关掉：SELinux</li> <li>创建本地数据存储 + 配置文件目录：<code>mkdir -p /data/docker/mysql/datadir /data/docker/mysql/conf /data/docker/mysql/log</code></li> <li>在宿主机上创建一个配置文件：<code>vim /data/docker/mysql/conf/mysql-1.cnf</code>，内容如下：</li></ul> <div class="language- extra-class"><pre class="language-text"><code># 该编码设置是我自己配置的
[mysql]
default-character-set = utf8mb4

# 下面内容是 docker mysql 默认的 start
[mysqld]
pid-file = /var/run/mysqld/mysqld.pid
socket = /var/run/mysqld/mysqld.sock
datadir = /var/lib/mysql
#log-error = /var/log/mysql/error.log
# By default we only accept connections from localhost
#bind-address = 127.0.0.1
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0
# 上面内容是 docker mysql 默认的 end

# 下面开始的内容就是我自己配置的
log-error=/var/log/mysql/error.log
default-storage-engine = InnoDB
collation-server = utf8mb4_unicode_ci
init_connect = 'SET NAMES utf8mb4'
character-set-server = utf8mb4
lower_case_table_names = 1
max_allowed_packet = 50M
</code></pre></div><ul><li>赋权（避免挂载的时候，一些程序需要容器中的用户的特定权限使用）：<code>chmod -R 777 /data/docker/mysql/datadir /data/docker/mysql/log</code></li> <li>赋权：<code>chown -R 0:0 /data/docker/mysql/conf</code> <ul><li>配置文件的赋权比较特殊，如果是给 777 权限会报：[Warning] World-writable config file '/etc/mysql/conf.d/mysql-1.cnf' is ignored，所以这里要特殊对待。容器内是用 root 的 uid，所以这里与之相匹配赋权即可。</li> <li>我是进入容器 bash 内，输入：<code>whoami &amp;&amp; id</code>，看到默认用户的 uid 是 0，所以这里才 chown 0</li></ul></li> <li><code>docker run -p 3306:3306 --name cloud-mysql -v /data/docker/mysql/datadir:/var/lib/mysql -v /data/docker/mysql/log:/var/log/mysql -v /data/docker/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</code></li> <li>连上容器：<code>docker exec -it cloud-mysql /bin/bash</code> <ul><li>连上 MySQL：<code>mysql -u root -p</code></li> <li>创建表：<code>CREATE DATABASE wormhole DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</code></li></ul></li> <li>关于容器的 MySQL 配置，官网是这样说的：<a href="https://hub.docker.com/_/mysql/" target="_blank" rel="noopener noreferrer">https://hub.docker.com/_/mysql/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><blockquote><p>The MySQL startup configuration is specified in the file /etc/mysql/my.cnf, and that file in turn includes any files found in the /etc/mysql/conf.d directory that end with .cnf.Settings in files in this directory will augment and/or override settings in /etc/mysql/my.cnf. If you want to use a customized MySQL configuration,you can create your alternative configuration file in a directory on the host machine and then mount that directory location as /etc/mysql/conf.d inside the mysql container.</p></blockquote></blockquote> <ul><li>容器中的 my.cnf 内容如下：</li></ul> <div class="language- extra-class"><pre class="language-text"><code># Copyright (c) 2016, Oracle and/or its affiliates. All rights reserved.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

!includedir /etc/mysql/conf.d/
!includedir /etc/mysql/mysql.conf.d/
</code></pre></div><ul><li>docker 的 MySQL 备份和还原：
<ul><li>备份：<code>docker exec cloud-mysql /usr/bin/mysqldump -u root --password=123456 DATABASE_Name &gt; /opt/backup.sql</code></li> <li>还原：<code>docker exec -i cloud-mysql /usr/bin/mysql -u root --password=123456 DATABASE_Name &lt; /opt/backup.sql</code></li></ul></li></ul> <hr> <h2 id="mysql-5-5-安装"><a href="#mysql-5-5-安装" class="header-anchor">#</a> MySQL 5.5 安装</h2> <ul><li><a href="https://blog.csdn.net/qingtian_1993/article/details/79692479" target="_blank" rel="noopener noreferrer">来源<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>设置仓库</li></ul> <div class="language- extra-class"><pre class="language-text"><code>rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm
rpm -Uvh https://mirror.webtatic.com/yum/el6/latest.rpm
</code></pre></div><ul><li>安装：<code>yum install mysql55w mysql55w-server</code>，用同时生产 mysql 的组和用户</li> <li>启动：<code>service mysqld start</code></li> <li>重置密码：<code>mysqladmin -u root password '123456'</code></li> <li>默认配置文件：<code>vim /etc/my.cnf</code></li> <li>log 目录：<code>cd /var/log/mysqld.log</code></li> <li>查看服务 log：<code>tail -300 /var/log/mysqld.log</code></li> <li>给指定目录增加 mysql 用户组权限：<code>chown mysql.mysql /var/run/mysqld/</code></li> <li>官网 MySQL 启动失败，这篇文章经验值得推荐：<a href="https://www.cnblogs.com/ivictor/p/5146247.html" target="_blank" rel="noopener noreferrer">CentOS 7下MySQL服务启动失败的解决思路<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <hr> <h2 id="mysql-5-6-安装"><a href="#mysql-5-6-安装" class="header-anchor">#</a> MySQL 5.6 安装</h2> <ul><li>假设当前用户为：root</li> <li>Mysql 安装
<ul><li>官网：<a href="http://www.mysql.com/" target="_blank" rel="noopener noreferrer">http://www.mysql.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>官网下载：<a href="http://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener noreferrer">http://dev.mysql.com/downloads/mysql/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>官网 5.5 下载：<a href="http://dev.mysql.com/downloads/mysql/5.5.html#downloads" target="_blank" rel="noopener noreferrer">http://dev.mysql.com/downloads/mysql/5.5.html#downloads<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>官网 5.6 下载：<a href="http://dev.mysql.com/downloads/mysql/5.6.html#downloads" target="_blank" rel="noopener noreferrer">http://dev.mysql.com/downloads/mysql/5.6.html#downloads<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>官网 5.7 下载：<a href="http://dev.mysql.com/downloads/mysql/5.7.html#downloads" target="_blank" rel="noopener noreferrer">http://dev.mysql.com/downloads/mysql/5.7.html#downloads<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>官网帮助中心：<a href="http://dev.mysql.com/doc/refman/5.6/en/source-installation.html" target="_blank" rel="noopener noreferrer">http://dev.mysql.com/doc/refman/5.6/en/source-installation.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>此时（20160210） Mysql 5.5 最新版本为：<strong>5.5.48</strong></li> <li>此时（20170130） Mysql 5.6 最新版本为：<strong>5.6.35</strong></li> <li>此时（20160210） Mysql 5.7 最新版本为：<strong>5.7.11</strong></li> <li>我个人习惯 <code>/opt</code> 目录下创建一个目录 <code>setups</code> 用来存放各种软件安装包；在 <code>/usr</code> 目录下创建一个 <code>program</code> 用来存放各种解压后的软件包，下面的讲解也都是基于此习惯</li> <li>我个人已经使用了第三方源：<code>EPEL、RepoForge</code>，如果你出现 <code>yum install XXXXX</code> 安装不成功的话，很有可能就是你没有相关源，请查看我对源设置的文章</li> <li>Mysql 5.6 下载：<code>wget http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.35.tar.gz</code> （大小：31 M）</li> <li>Mysql 5.7 下载：<code>wget http://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.11.tar.gz</code> （大小：47 M）</li> <li>我们这次安装以 5.6 为实例
<ul><li>进入下载目录：<code>cd /opt/setups</code></li> <li>解压压缩包：<code>tar zxvf mysql-5.6.35.tar.gz</code></li> <li>移到解压包：<code>mv /opt/setups/mysql-5.6.35 /usr/local/</code></li> <li>安装依赖包、编译包：<code>yum install -y make gcc-c++ cmake bison-devel ncurses-devel autoconf</code></li> <li>进入解压目录：<code>cd /usr/local/mysql-5.6.35/</code></li> <li>生成安装目录：<code>mkdir -p /usr/local/mysql/data</code></li> <li>生成配置（使用 InnoDB）：<code>cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/usr/local/mysql/data -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DDEFAULT_CHARSET=utf8mb4 -DDEFAULT_COLLATION=utf8mb4_unicode_ci -DWITH_EXTRA_CHARSETS:STRING=utf8mb4 -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DENABLED_LOCAL_INFILE=1</code> <ul><li>更多参数说明可以查看：<a href="http://dev.mysql.com/doc/refman/5.6/en/source-configuration-options.html" target="_blank" rel="noopener noreferrer">http://dev.mysql.com/doc/refman/5.6/en/source-configuration-options.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>编译：<code>make</code>，这个过程比较漫长，一般都在 30 分钟左右，具体还得看机子配置，如果最后结果有 error，建议删除整个 mysql 目录后重新解压一个出来继续处理</li> <li>安装：<code>make install</code></li> <li>配置开机启动：
<ul><li><code>cp /usr/local/mysql-5.6.35/support-files/mysql.server /etc/init.d/mysql</code></li> <li><code>chmod 755 /etc/init.d/mysql</code></li> <li><code>chkconfig mysql on</code></li></ul></li> <li>复制一份配置文件： <code>cp /usr/local/mysql-5.6.35/support-files/my-default.cnf /etc/my.cnf</code></li> <li>删除安装的目录：<code>rm -rf /usr/local/mysql-5.6.35/</code></li> <li>添加组和用户及安装目录权限
<ul><li><code>groupadd mysql</code> #添加组</li> <li><code>useradd -g mysql mysql -s /bin/false</code> #创建用户mysql并加入到mysql组，不允许mysql用户直接登录系统</li> <li><code>chown -R mysql:mysql /usr/local/mysql/data</code> #设置MySQL数据库目录权限</li></ul></li> <li>初始化数据库：<code>/usr/local/mysql/scripts/mysql_install_db --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --skip-name-resolve --user=mysql</code></li> <li>开放防火墙端口：
<ul><li><code>iptables -I INPUT -p tcp -m tcp --dport 3306 -j ACCEPT</code></li> <li><code>service iptables save</code></li> <li><code>service iptables restart</code></li></ul></li> <li>禁用 selinux
<ul><li>编辑配置文件：<code>vim /etc/selinux/config</code></li> <li>把 <code>SELINUX=enforcing</code> 改为 <code>SELINUX=disabled</code></li></ul></li> <li>常用命令软连接，才可以在终端直接使用：mysql 和 mysqladmin 命令
<ul><li><code>ln -s /usr/local/mysql/bin/mysql /usr/bin</code></li> <li><code>ln -s /usr/local/mysql/bin/mysqladmin /usr/bin</code></li> <li><code>ln -s /usr/local/mysql/bin/mysqldump /usr/bin</code></li> <li><code>ln -s /usr/local/mysql/bin/mysqlslap /usr/bin</code></li></ul></li></ul></li></ul></li></ul> <h2 id="mysql-5-7-yum-安装"><a href="#mysql-5-7-yum-安装" class="header-anchor">#</a> MySQL 5.7 YUM 安装</h2> <ul><li>官网：<a href="https://dev.mysql.com/doc/refman/5.7/en/linux-installation-yum-repo.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/5.7/en/linux-installation-yum-repo.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language- extra-class"><pre class="language-text"><code>
禁用 selinux：setenforce 0

wget https://repo.mysql.com//mysql57-community-release-el7-11.noarch.rpm
yum localinstall mysql57-community-release-el7-11.noarch.rpm
yum install mysql-community-server
一共 194M

配置文件：/etc/my.cnf
systemctl start mysqld
systemctl status mysqld

查看初次使用的临时密码：grep 'temporary password' /var/log/mysqld.log

</code></pre></div><hr> <h2 id="mysql-配置"><a href="#mysql-配置" class="header-anchor">#</a> MySQL 配置</h2> <ul><li>官网配置参数解释：<a href="http://dev.mysql.com/doc/refman/5.6/en/mysqld-option-tables.html" target="_blank" rel="noopener noreferrer">http://dev.mysql.com/doc/refman/5.6/en/mysqld-option-tables.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>找一下当前系统中有多少个 my.cnf 文件：<code>find / -name &quot;my.cnf&quot;</code>，我查到的结果：</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code>/etc/my.cnf
/usr/local/mysql/my.cnf
/usr/local/mysql/mysql-test/suite/ndb/my.cnf
/usr/local/mysql/mysql-test/suite/ndb_big/my.cnf
.............
/usr/local/mysql/mysql-test/suite/ndb_rpl/my.cnf
</code></pre></div><ul><li>保留 <strong>/etc/my.cnf</strong> 和 <strong>/usr/local/mysql/mysql-test/</strong> 目录下配置文件，其他删除掉。</li> <li>我整理的一个单机版配置说明（MySQL 5.6，适用于 1G 内存的服务器）：
<ul><li><a href="MySQL-Settings/MySQL-5.6/1G-Memory-Machine/my-for-comprehensive.cnf">my.cnf</a></li></ul></li> <li>其中我测试的结果，在不适用任何配置修改的情况下，1G 内存安装 MySQL 5.6 默认就会占用 400M 左右的内存，要降下来的核心配置要补上这几个参数：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>performance_schema_max_table_instances=400
table_definition_cache=400
table_open_cache=256
</code></pre></div><h2 id="修改-root-账号密码"><a href="#修改-root-账号密码" class="header-anchor">#</a> 修改 root 账号密码</h2> <ul><li>启动 Mysql 服务器（CentOS 6）：<code>service mysql start</code></li> <li>启动 Mysql 服务器（CentOS 7）：<code>systemctl start mysql</code></li> <li>查看是否已经启动了：<code>ps aux | grep mysql</code></li> <li>默认安装情况下，root 的密码是空，所以为了方便我们可以设置一个密码，假设我设置为：123456</li> <li>终端下执行：<code>mysql -uroot</code> <ul><li>现在进入了 mysql 命令行管理界面，输入：<code>SET PASSWORD = PASSWORD('123456');FLUSH PRIVILEGES;</code></li> <li>现在进入了 mysql 命令行管理界面，输入：<code>UPDATE user SET authentication_string=PASSWORD('123456') where USER='root';FLUSH PRIVILEGES;</code></li></ul></li> <li>修改密码后，终端下执行：<code>mysql -uroot -p</code> <ul><li>根据提示，输入密码进度 mysql 命令行状态。</li></ul></li> <li>如果你在其他机子上连接该数据库机子报：<strong>Access denied for user 'root'@'localhost' (using password: YES)</strong> <ul><li>解决办法：</li> <li>在终端中执行（CentOS 6）：<code>service mysql stop</code></li> <li>在终端中执行（CentOS 7）：<code>systemctl stop mysql</code></li> <li>在终端中执行（前面添加的 Linux 用户 mysql 必须有存在）：<code>/usr/local/mysql/bin/mysqld --skip-grant-tables --user=mysql</code> <ul><li>此时 MySQL 服务会一直处于监听状态，你需要另起一个终端窗口来执行接下来的操作</li> <li>在终端中执行：<code>mysql -u root mysql</code> 或者：<code>mysql -h 127.0.0.1 -u root -P 3306 -p</code></li> <li>把密码改为：123456，进入 MySQL 命令后执行：<code>UPDATE user SET Password=PASSWORD('123456') where USER='root';FLUSH PRIVILEGES;</code></li> <li>然后重启 MySQL 服务（CentOS 6）：<code>service mysql restart</code></li> <li>然后重启 MySQL 服务（CentOS 7）：<code>systemctl restart mysql</code></li></ul></li></ul></li></ul> <h2 id="连接报错-host-192-168-1-133-is-not-allowed-to-connect-to-this-mysql-server"><a href="#连接报错-host-192-168-1-133-is-not-allowed-to-connect-to-this-mysql-server" class="header-anchor">#</a> 连接报错：&quot;Host '192.168.1.133' is not allowed to connect to this MySQL server&quot;</h2> <ul><li>不允许除了 localhost 之外去连接，解决办法，进入 MySQL 命令行，输入下面内容：</li> <li>开发机设置允许任何机子访问：
<ul><li><code>vim /etc/my.cnf</code> 中不能有：<code>bind-address = 127.0.0.1</code></li> <li>配置：<code>GRANT ALL PRIVILEGES ON *.* TO '数据库用户名'@'%' IDENTIFIED BY '数据库用户名的密码' WITH GRANT OPTION;</code></li> <li>更新配置：<code>flush privileges;</code></li></ul></li> <li>生产机设置只运行本机访问：
<ul><li><code>vim /etc/my.cnf</code> 中必须有：<code>bind-address = 127.0.0.1</code></li> <li>配置：<code>GRANT ALL PRIVILEGES ON *.* TO '数据库用户名'@'127.0.0.1' IDENTIFIED BY '数据库用户名的密码' WITH GRANT OPTION;</code></li> <li>更新配置：<code>flush privileges;</code></li></ul></li></ul> <h2 id="修改密码报错-your-password-does-not-satisfy-the-current-policy-requirements"><a href="#修改密码报错-your-password-does-not-satisfy-the-current-policy-requirements" class="header-anchor">#</a> 修改密码报错：Your password does not satisfy the current policy requirements</h2> <ul><li>MySQL 5.7 安全性要求更高，需要这么做：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>set global validate_password_policy=0; #密码强度设为最低等级
set global validate_password_length=6; #密码允许最小长度为6
set password = password('新密码');
FLUSH PRIVILEGES;
</code></pre></div><h2 id="mysql-5-7"><a href="#mysql-5-7" class="header-anchor">#</a> MySQL 5.7</h2> <ul><li>报错内容：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>Expression #1 of ORDER BY clause is not in GROUP BY clause and contains nonaggregated column 'youmeek.nm.id' 
which is not functionally dependent on columns in GROUP BY clause; 
this is incompatible with sql_mode=only_full_group_by
</code></pre></div><ul><li>查下自己的模式：<code>select version(), @@sql_mode;</code></li> <li>解决办法，修改 my.cnf，增加这一行：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION;
</code></pre></div><h2 id="小内存机子-mysql-频繁挂掉解决办法-1g-centos-7-4"><a href="#小内存机子-mysql-频繁挂掉解决办法-1g-centos-7-4" class="header-anchor">#</a> 小内存机子，MySQL 频繁挂掉解决办法（1G + CentOS 7.4）</h2> <ul><li>保存系统日志到本地进行查看：<code>cd /var/log/ &amp;&amp; sz messages</code></li> <li>其中可以看到这样的几句话（可以知道内存不够了）：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>Jul  6 21:49:14 VM_123_201_centos kernel: Out of memory: Kill process 19452 (httpd) score 36 or sacrifice child
Jul  6 21:49:14 VM_123_201_centos kernel: Killed process 19452 (httpd) total-vm:516404kB, anon-rss:36088kB, file-rss:168kB, shmem-rss:12kB
</code></pre></div><ul><li>对于 1G 的内存 MySQL（5.6.35），建议重点下面配置：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>[mysqld]
table_definition_cache=400
table_open_cache=256
innodb_buffer_pool_size = 64M
max_connections = 100 
</code></pre></div><ul><li>增加 swap（云服务基本都是没 swap 的）</li> <li>分别执行下面 shell 命令：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>dd if=/dev/zero of=/swapfile bs=1M count=1024
mkswap /swapfile
swapon /swapfile
</code></pre></div><ul><li>修改配置文件：<code>vim /etc/fstab</code> <ul><li>添加这句在文件最后一行：<code>/swapfile swap swap defauluts 0 0</code></li></ul></li> <li>重启机子：<code>reboot</code></li></ul> <h2 id="mysql-主从复制"><a href="#mysql-主从复制" class="header-anchor">#</a> MySQL 主从复制</h2> <h3 id="环境说明和注意点"><a href="#环境说明和注意点" class="header-anchor">#</a> 环境说明和注意点</h3> <ul><li>假设有两台服务器，一台做主，一台做从
<ul><li>MySQL 主信息：
<ul><li>IP：<strong>12.168.1.113</strong></li> <li>端口：<strong>3306</strong></li></ul></li> <li>MySQL 从信息：
<ul><li>IP：<strong>12.168.1.115</strong></li> <li>端口：<strong>3306</strong></li></ul></li></ul></li> <li>注意点
<ul><li>主 DB server 和从 DB server 数据库的版本一致</li> <li>主 DB server 和从 DB server 数据库数据一致</li> <li>主 DB server 开启二进制日志，主 DB server 和从 DB server 的 server-id 都必须唯一</li></ul></li> <li>优先操作：
<ul><li><strong>把主库的数据库复制到从库并导入</strong></li></ul></li></ul> <h3 id="主库机子操作"><a href="#主库机子操作" class="header-anchor">#</a> 主库机子操作</h3> <ul><li><p>主库操作步骤</p> <ul><li>创建一个目录：<code>mkdir -p /usr/local/mysql/data/mysql-bin</code></li> <li>主 DB 开启二进制日志功能：<code>vim /etc/my.cnf</code>，
<ul><li>添加一行：<code>log-bin = /usr/local/mysql/data/mysql-bin</code></li> <li>指定同步的数据库，如果不指定则同步全部数据库，其中 ssm 是我的数据库名：<code>binlog-do-db=ssm</code></li></ul></li> <li>主库关掉慢查询记录，用 SQL 语句查看当前是否开启：<code>SHOW VARIABLES LIKE '%slow_query_log%';</code>，如果显示 OFF 则表示关闭，ON 表示开启</li> <li>重启主库 MySQL 服务</li> <li>进入 MySQL 命令行状态，执行 SQL 语句查询状态：<code>SHOW MASTER STATUS;</code> <ul><li>在显示的结果中，我们需要记录下 <strong>File</strong> 和 <strong>Position</strong> 值，等下从库配置有用。</li></ul></li> <li>设置授权用户 slave01 使用 123456 密码登录主库，这里 @ 后的 IP 为从库机子的 IP 地址，如果从库的机子有多个，我们需要多个这个 SQL 语句。</li></ul> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">grant</span> <span class="token keyword">replication</span> slave <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'slave01'</span><span class="token variable">@'192.168.1.135'</span> identified <span class="token keyword">by</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="从库机子操作"><a href="#从库机子操作" class="header-anchor">#</a> 从库机子操作</h3> <ul><li><p>从库操作步骤</p> <ul><li>从库开启慢查询记录，用 SQL 语句查看当前是否开启：<code>SHOW VARIABLES LIKE '%slow_query_log%';</code>，如果显示 OFF 则表示关闭，ON 表示开启。</li> <li>测试从库机子是否能连上主库机子：<code>mysql -h 192.168.1.105 -u slave01 -p</code>，必须要连上下面的操作才有意义。
<ul><li>由于不能排除是不是系统防火墙的问题，所以建议连不上临时关掉防火墙：<code>service iptables stop</code></li> <li>或是添加防火墙规则：
<ul><li>添加规则：<code>iptables -I INPUT -p tcp -m tcp --dport 3306 -j ACCEPT</code></li> <li>保存规则：<code>service iptables save</code></li> <li>重启 iptables：<code>service iptables restart</code></li></ul></li></ul></li> <li>修改配置文件：<code>vim /etc/my.cnf</code>，把 server-id 改为跟主库不一样</li> <li>在进入 MySQL 的命令行状态下，输入下面 SQL：</li></ul> <div class="language-SQL extra-class"><pre class="language-sql"><code>CHANGE MASTER <span class="token keyword">TO</span>
master_host<span class="token operator">=</span><span class="token string">'192.168.1.113'</span><span class="token punctuation">,</span>
master_user<span class="token operator">=</span><span class="token string">'slave01'</span><span class="token punctuation">,</span>
master_password<span class="token operator">=</span><span class="token string">'123456'</span><span class="token punctuation">,</span>
master_port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>
master_log_file<span class="token operator">=</span><span class="token string">'mysql3306-bin.000006'</span><span class="token punctuation">,</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>这个值复制刚刚让你记录的值
master_log_pos<span class="token operator">=</span><span class="token number">1120</span><span class="token punctuation">;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>这个值复制刚刚让你记录的值
</code></pre></div></li> <li><p>执行该 SQL 语句，启动 slave 同步：<code>START SLAVE;</code></p></li> <li><p>执行该 SQL 语句，查看从库机子同步状态：<code>SHOW SLAVE STATUS;</code></p></li> <li><p>在查看结果中必须下面两个值都是 Yes 才表示配置成功：</p> <ul><li><code>Slave_IO_Running:Yes</code> <ul><li>如果不是 Yes 也不是 No，而是 Connecting，那就表示从机连不上主库，需要你进一步排查连接问题。</li></ul></li> <li><code>Slave_SQL_Running:Yes</code></li></ul></li> <li><p>如果你的 Slave_IO_Running 是 No，一般如果你是在虚拟机上测试的话，从库的虚拟机是从主库的虚拟机上复制过来的，那一般都会这样的，因为两台的 MySQL 的 UUID 值一样。你可以检查从库下的错误日志：<code>cat /usr/local/mysql/data/mysql-error.log</code></p> <ul><li>如果里面提示 uuid 错误，你可以编辑从库的这个配置文件：<code>vim /usr/local/mysql/data/auto.cnf</code>，把配置文件中的：server-uuid 值随便改一下，保证和主库是不一样即可。</li></ul></li></ul> <h2 id="资料"><a href="#资料" class="header-anchor">#</a> 资料</h2> <ul><li><a href="http://www.cnblogs.com/xiongpq/p/3384681.html" target="_blank" rel="noopener noreferrer">http://www.cnblogs.com/xiongpq/p/3384681.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/adminlove520/Linux_All_in_one/edit/main/docs/linux/soft/Databases/Mysql-Install-And-Settings.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3 hours ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/Linux_All_in_one/assets/js/app.4a61619a.js" defer></script><script src="/Linux_All_in_one/assets/js/2.ee3c5eb7.js" defer></script><script src="/Linux_All_in_one/assets/js/1.bc260717.js" defer></script><script src="/Linux_All_in_one/assets/js/79.48030292.js" defer></script><script src="/Linux_All_in_one/assets/js/21.f8578145.js" defer></script>
  </body>
</html>

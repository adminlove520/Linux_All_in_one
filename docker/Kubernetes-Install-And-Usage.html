<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes éƒ¨ç½² | Linux_All_in_one</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/Linux_All_in_one/favicon.ico">
    <meta name="description" content="Linux è¿ç»´ã€è½¯ä»¶è¿ç»´ã€Docker æ•™ç¨‹ã€ç½‘ç»œå®‰å…¨">
    
    <link rel="preload" href="/Linux_All_in_one/assets/css/0.styles.407428ab.css" as="style"><link rel="preload" href="/Linux_All_in_one/assets/js/app.4a61619a.js" as="script"><link rel="preload" href="/Linux_All_in_one/assets/js/2.ee3c5eb7.js" as="script"><link rel="preload" href="/Linux_All_in_one/assets/js/1.bc260717.js" as="script"><link rel="preload" href="/Linux_All_in_one/assets/js/37.c49eb234.js" as="script"><link rel="preload" href="/Linux_All_in_one/assets/js/21.f8578145.js" as="script"><link rel="prefetch" href="/Linux_All_in_one/assets/js/100.5e0212b4.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/101.280ba6c4.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/102.fcbe69ef.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/103.59b3bf86.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/104.628bb6be.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/105.f6a0a62b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/106.53648c35.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/107.093c4fab.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/108.f8895b2f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/109.878b5e6d.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/110.e7dbd5ce.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/12.4bdd7f50.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/13.4850c8c8.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/14.66e24ed5.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/15.41d57e79.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/16.96600c16.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/17.1cd68a21.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/18.f54ebd77.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/19.36d25975.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/20.0120ca8c.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/22.9efa850b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/23.d7f5441c.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/24.1cabd94c.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/25.2cb5712a.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/26.440ab754.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/27.94e60af2.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/28.f1611369.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/29.730dead3.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/3.accc0318.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/30.f69c3378.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/31.be2478fc.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/32.9465ce70.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/33.f4c85e8a.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/34.c3a0ece1.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/35.a75dd538.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/36.da0b8594.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/38.16f7d0e5.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/39.ba6e47f0.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/4.9736648b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/40.664ddb58.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/41.4189f6ca.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/42.6472b832.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/43.c8d06688.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/44.e39a047e.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/45.39945860.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/46.ccbd9cdc.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/47.9bed3a75.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/48.05ecd397.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/49.4f2f2874.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/5.9a4eb5c9.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/50.d01632db.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/51.ad40e5f5.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/52.bfacfa08.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/53.9398692c.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/54.b34cb199.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/55.6735c148.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/56.575312d7.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/57.d54f0ac7.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/58.f3cc4cf5.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/59.881dba8f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/6.a3475002.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/60.859faf8a.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/61.4efca474.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/62.578a9742.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/63.95e6ff4f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/64.054ab297.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/65.5be33d9b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/66.2312529e.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/67.81dd084d.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/68.a11966f3.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/69.ffbf7d57.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/7.b4d90be9.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/70.51883659.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/71.9ff55cae.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/72.d54e184f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/73.5062fbf7.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/74.0721cccd.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/75.42dd3581.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/76.d590fa57.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/77.0e5953f3.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/78.4bb79720.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/79.48030292.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/80.d036bc22.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/81.d6524746.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/82.93460687.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/83.7c6f2e4a.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/84.83b1808d.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/85.14c12ffc.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/86.893b5c41.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/87.7d10879f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/88.ef12068f.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/89.cc81e4e4.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/90.130454fc.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/91.838da398.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/92.22813cd9.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/93.2000427b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/94.062717c8.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/95.9cc81974.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/96.0457546b.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/97.71d6bbd5.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/98.e6299973.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/99.b198a395.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/vendors~docsearch.00f0a528.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/vendors~flowchart.d07b8b19.js"><link rel="prefetch" href="/Linux_All_in_one/assets/js/vendors~notification.877bb3fc.js">
    <link rel="stylesheet" href="/Linux_All_in_one/assets/css/0.styles.407428ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Linux_All_in_one/" class="home-link router-link-active"><img src="/Linux_All_in_one/images/dunwu-logo-100.png" alt="Linux_All_in_one" class="logo"> <span class="site-name can-hide">Linux_All_in_one</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Linux_All_in_one/linux/cli/" class="nav-link">
  ğŸ’» Linux å‘½ä»¤
</a></div><div class="nav-item"><a href="/Linux_All_in_one/linux/ops/" class="nav-link">
  âš™ï¸ Linux è¿ç»´
</a></div><div class="nav-item"><a href="/Linux_All_in_one/linux/soft/" class="nav-link">
  ğŸ“¦ Linux è½¯ä»¶è¿ç»´
</a></div><div class="nav-item"><a href="/Linux_All_in_one/docker/" class="nav-link router-link-active">
  ğŸ³ Docker æ•™ç¨‹
</a></div><div class="nav-item"><a href="/Linux_All_in_one/Cybersecurity/" class="nav-link">
  ğŸ”’ Linuxä¸ç½‘ç»œå®‰å…¨
</a></div> <a href="https://github.com/adminlove520/Linux_All_in_one" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Linux_All_in_one/linux/cli/" class="nav-link">
  ğŸ’» Linux å‘½ä»¤
</a></div><div class="nav-item"><a href="/Linux_All_in_one/linux/ops/" class="nav-link">
  âš™ï¸ Linux è¿ç»´
</a></div><div class="nav-item"><a href="/Linux_All_in_one/linux/soft/" class="nav-link">
  ğŸ“¦ Linux è½¯ä»¶è¿ç»´
</a></div><div class="nav-item"><a href="/Linux_All_in_one/docker/" class="nav-link router-link-active">
  ğŸ³ Docker æ•™ç¨‹
</a></div><div class="nav-item"><a href="/Linux_All_in_one/Cybersecurity/" class="nav-link">
  ğŸ”’ Linuxä¸ç½‘ç»œå®‰å…¨
</a></div> <a href="https://github.com/adminlove520/Linux_All_in_one" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Kubernetes éƒ¨ç½²</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Linux_All_in_one/docker/Kubernetes-Install-And-Usage.html#ç¯å¢ƒè¯´æ˜" class="sidebar-link">ç¯å¢ƒè¯´æ˜</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/docker/Kubernetes-Install-And-Usage.html#æ‰€æœ‰æœºå­éƒ½éœ€è¦çš„ç¯å¢ƒå‡†å¤‡" class="sidebar-link">æ‰€æœ‰æœºå­éƒ½éœ€è¦çš„ç¯å¢ƒå‡†å¤‡</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/docker/Kubernetes-Install-And-Usage.html#å®‰è£…è¿‡ç¨‹" class="sidebar-link">å®‰è£…è¿‡ç¨‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Linux_All_in_one/docker/Kubernetes-Install-And-Usage.html#èµ„æ–™" class="sidebar-link">èµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kubernetes-éƒ¨ç½²"><a href="#kubernetes-éƒ¨ç½²" class="header-anchor">#</a> Kubernetes éƒ¨ç½²</h1> <h2 id="ç¯å¢ƒè¯´æ˜"><a href="#ç¯å¢ƒè¯´æ˜" class="header-anchor">#</a> ç¯å¢ƒè¯´æ˜</h2> <ul><li>CentOS 7.4</li> <li>è´­ä¹°è‡ªé˜¿é‡Œäº‘æ™®é€šçš„ ECS åå—åœ°åŒºï¼ˆå¦‚æœä½ æ˜¯è´­ä¹°ç¾å›½åœ°åŒºçš„æœåŠ¡å™¨ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ kubespray åŸé¡¹ç›®ï¼Œé‚£äº›é•œåƒåœ°å€ä¸ç”¨ä¿®æ”¹ï¼Œå…¶ä»–ç…§ç€æ–‡æ¡£å³å¯ï¼‰</li> <li>æ‰€æœ‰æœºå­éƒ½æ˜¯å¹²å‡€çš„ä¸éœ€è¦å…ˆå®‰è£… Docker ç­‰å…¶ä»–å®¹å™¨ç›¸å…³çš„ä¸œè¥¿</li> <li>å»ºè®®è¿˜æ˜¯ç”¨ç¾å›½æœåŠ¡å™¨ï¼Œä¸ç„¶å„ç§ç½‘ç»œçš„å‘</li></ul> <table><thead><tr><th>æœºå™¨ç®€ç§°</th> <th>å†…ç½‘ IP åœ°å€</th> <th>éƒ¨ç½²è½¯ä»¶</th> <th>ç³»ç»Ÿç¯å¢ƒ</th> <th>ç¡¬ä»¶é…ç½®</th></tr></thead> <tbody><tr><td>æ“ä½œæœº</td> <td>172.20.229.224</td> <td>ansible</td> <td>CentOS 7.4</td> <td>1 vCPU + 2 GB</td></tr> <tr><td>node1</td> <td>172.20.229.225</td> <td>master</td> <td>CentOS 7.4</td> <td>1 vCPU + 4 GB</td></tr> <tr><td>node2</td> <td>172.20.229.226</td> <td>worker</td> <td>CentOS 7.4</td> <td>1 vCPU + 4 GB</td></tr> <tr><td>node3</td> <td>172.20.229.227</td> <td>worker</td> <td>CentOS 7.4</td> <td>1 vCPU + 4 GB</td></tr></tbody></table> <h2 id="æ‰€æœ‰æœºå­éƒ½éœ€è¦çš„ç¯å¢ƒå‡†å¤‡"><a href="#æ‰€æœ‰æœºå­éƒ½éœ€è¦çš„ç¯å¢ƒå‡†å¤‡" class="header-anchor">#</a> æ‰€æœ‰æœºå­éƒ½éœ€è¦çš„ç¯å¢ƒå‡†å¤‡</h2> <ul><li>å…³é—­ SELinux
<ul><li>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š<code>vim /etc/selinux/config</code></li> <li>æŠŠ <code>SELINUX=enforcing</code> æ”¹ä¸º <code>SELINUX=disabled</code></li></ul></li></ul> <p>æ‰€æœ‰èŠ‚ç‚¹å…³é—­é˜²ç«å¢™ï¼š<code>systemctl stop firewalld &amp;&amp; systemctl disable firewalld</code></p> <p>å®‰è£…è‡ªå·±å¸¸ç”¨çš„ä¸€äº›ç»„ä»¶ï¼ˆéå¿…é¡»ï¼‰ï¼švim zsh zip unzip lrzsz git</p> <h2 id="å®‰è£…è¿‡ç¨‹"><a href="#å®‰è£…è¿‡ç¨‹" class="header-anchor">#</a> å®‰è£…è¿‡ç¨‹</h2> <h4 id="æ“ä½œæœºå®‰è£…-ansible"><a href="#æ“ä½œæœºå®‰è£…-ansible" class="header-anchor">#</a> æ“ä½œæœºå®‰è£… ansible</h4> <h1 id="yum-install-y-epel-releaseyum-install-y-python34-python34-pip-python-pip-python-netaddr-ansible-gitpip-install-upgrade-jinja2yum-install-y-gcc-libffi-devel-python-devel-openssl-devel"><a href="#yum-install-y-epel-releaseyum-install-y-python34-python34-pip-python-pip-python-netaddr-ansible-gitpip-install-upgrade-jinja2yum-install-y-gcc-libffi-devel-python-devel-openssl-devel" class="header-anchor">#</a> =================================
yum install -y epel-release
yum install -y python34 python34-pip python-pip python-netaddr ansible git
pip install --upgrade Jinja2
yum install -y gcc libffi-devel python-devel openssl-devel</h1> <p>æ“ä½œæœºå…å¯†ç ç™»å½•åˆ°å…¶ä»–èŠ‚ç‚¹</p> <p>å¦‚æœè¿˜ä¸æ‡‚å¯ä»¥å…·ä½“çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼š<a href=""></a>
ssh-keygen
ssh-copy-id -i /root/.ssh/id_rsa.pub -p 22 root@172.20.229.225
ssh-copy-id -i /root/.ssh/id_rsa.pub -p 22 root@172.20.229.226
ssh-copy-id -i /root/.ssh/id_rsa.pub -p 22 root@172.20.229.227</p> <p>æµ‹è¯•ä¸‹æ˜¯å¦å¯ä»¥å…ç™»é™†ï¼š
ssh -p 22 root@172.20.229.225
ssh -p 22 root@172.20.229.226
ssh -p 22 root@172.20.229.227</p> <h4 id="ä¿®æ”¹-kubespray-é¡¹ç›®é…ç½®"><a href="#ä¿®æ”¹-kubespray-é¡¹ç›®é…ç½®" class="header-anchor">#</a> ä¿®æ”¹ kubespray é¡¹ç›®é…ç½®</h4> <ul><li>kubespray é¡¹ç›®å®˜ç½‘ï¼š<a href="https://github.com/kubernetes-incubator/kubespray" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes-incubator/kubespray<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>åœ¨æœ¬åœ°æœºå­ä¸Š</p> <p>git clone https://github.com/kubernetes-incubator/kubespray.git</p> <p>å½“å‰æ—¶é—´ï¼ˆ2018-02ï¼‰æœ€æ–°ç‰ˆæœ¬æ˜¯ï¼šv2.4.0ï¼Œæ‰€ä»¥æˆ‘ checkout v2.4.0 çš„ tag</p> <p>ç”¨ IntelliJ IDEA æ‰“å¼€è¯¥é¡¹ç›®ï¼Œç„¶åæ‰¹é‡æ›¿æ¢ï¼š</p> <ul><li><code>gcr.io/</code> æ›¿æ¢æˆï¼š<code>registry.cn-hangzhou.aliyuncs.com/</code></li> <li>å› ä¸º gcr.io è¿™ä¸ªç½‘ç«™çš„æœ¬åœ°å€æ˜¯ï¼šhttps://cloud.google.com/container-registry/ï¼Œå›½å†…çš„ç¯å¢ƒå½“ç„¶å°±æ²¡èµ„æ ¼ä¸Šäº†ï¼Œæ‰€ä»¥æ‰è¦æ›¿æ¢ã€‚</li> <li>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®˜ç½‘çš„è¿™äº›é•œåƒé˜¿é‡Œäº‘ä¸ä¸€å®šæœ‰ï¼Œæ‰€ä»¥ç¨³å¦¥ç‚¹ï¼Œä½ æœ€å¥½å¯ä»¥å»é˜¿é‡Œäº‘æ£€æŸ¥ä¸‹çš„ï¼š<a href="https://dev.aliyun.com/search.html" target="_blank" rel="noopener noreferrer">https://dev.aliyun.com/search.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œæˆ–è€…æ˜¯ï¼š<a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">https://hub.docker.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>======================================================</p> <p>cd /opt/kubespray &amp;&amp; cp -rfp inventory/sample inventory/mycluster</p> <p>ä¿®æ”¹ï¼šinventory/mycluster/hosts.ini
python3 contrib/inventory_builder/inventory.py 172.20.229.225 172.20.229.226 172.20.229.227</p> <h1 id="review-and-change-parameters-under-inventory-mycluster-group-vars"><a href="#review-and-change-parameters-under-inventory-mycluster-group-vars" class="header-anchor">#</a> Review and change parameters under <code>inventory/mycluster/group_vars</code></h1> <p>cat inventory/mycluster/group_vars/all.yml
cat inventory/mycluster/group_vars/k8s-cluster.yml</p> <p>ä¿®æ”¹ /kubespray/inventory/mycluster/hosts.iniï¼Œæ”¹ä¸ºå¦‚ä¸‹å†…å®¹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>node1 ansible_ssh_host=172.20.229.225 ansible_user=root ip=172.20.229.225
node2 ansible_ssh_host=172.20.229.226 ansible_user=root ip=172.20.229.226
node3 ansible_ssh_host=172.20.229.227 ansible_user=root ip=172.20.229.227

[kube-master]
node1

[etcd]
node1

[kube-node]
node2
node3

[k8s-cluster:children]
kube-node
kube-master
</code></pre></div><p>ç„¶åæŠŠè¿™ä¸ªé¡¹ç›®å‹ç¼©æˆ zip ä¸Šä¼ åˆ°æ“ä½œæœºçš„ /opt æ ¹ç›®å½•ä¸Šï¼Œç„¶åè§£å‹ã€‚</p> <p>ç„¶ååœ¨æ“ä½œæœºä¸Šæ‰§è¡Œï¼š<code>cd /opt/kubespray &amp;&amp; ansible-playbook -i inventory/mycluster/hosts.ini cluster.yml</code>
ç„¶åä¼šå¼€å§‹è¾“å‡ºä¸€å¤§å †æ‰§è¡Œä»»åŠ¡çš„ä¸œè¥¿ï¼Œç­‰ç­‰å§ï¼Œé¢„è®¡éœ€è¦ 20~60 åˆ†é’Ÿå·¦å³ã€‚</p> <p>ç„¶åæŠ¥é”™ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>Thursday 08 February 2018  18:03:14 +0800 (0:00:00.038)       0:04:14.420 ***** 
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (4 retries left).
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (4 retries left).
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (4 retries left).
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (3 retries left).
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (3 retries left).
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (3 retries left).
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (2 retries left).
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (2 retries left).
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (2 retries left).
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (1 retries left).
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (1 retries left).
fatal: [node1]: FAILED! =&gt; {&quot;attempts&quot;: 4, &quot;changed&quot;: true, &quot;cmd&quot;: [&quot;/usr/bin/docker&quot;, &quot;pull&quot;, &quot;registry.cn-hangzhou.aliyuncs.com/google_containers/cluster-proportional-autoscaler-amd64:1.1.2&quot;], &quot;delta&quot;: &quot;0:00:00.413852&quot;, &quot;end&quot;: &quot;2018-02-08 18:03:38.396245&quot;, &quot;msg&quot;: &quot;non-zero return code&quot;, &quot;rc&quot;: 1, &quot;start&quot;: &quot;2018-02-08 18:03:37.982393&quot;, &quot;stderr&quot;: &quot;Error response from daemon: repository registry.cn-hangzhou.aliyuncs.com/google_containers/cluster-proportional-autoscaler-amd64 not found: does not exist or no pull access&quot;, &quot;stderr_lines&quot;: [&quot;Error response from daemon: repository registry.cn-hangzhou.aliyuncs.com/google_containers/cluster-proportional-autoscaler-amd64 not found: does not exist or no pull access&quot;], &quot;stdout&quot;: &quot;&quot;, &quot;stdout_lines&quot;: []}
FAILED - RETRYING: container_download | Download containers if pull is required or told to always pull (all nodes) (1 retries left).
fatal: [node3]: FAILED! =&gt; {&quot;attempts&quot;: 4, &quot;changed&quot;: true, &quot;cmd&quot;: [&quot;/usr/bin/docker&quot;, &quot;pull&quot;, &quot;registry.cn-hangzhou.aliyuncs.com/google_containers/cluster-proportional-autoscaler-amd64:1.1.2&quot;], &quot;delta&quot;: &quot;0:00:00.421977&quot;, &quot;end&quot;: &quot;2018-02-08 18:03:42.334875&quot;, &quot;msg&quot;: &quot;non-zero return code&quot;, &quot;rc&quot;: 1, &quot;start&quot;: &quot;2018-02-08 18:03:41.912898&quot;, &quot;stderr&quot;: &quot;Error response from daemon: repository registry.cn-hangzhou.aliyuncs.com/google_containers/cluster-proportional-autoscaler-amd64 not found: does not exist or no pull access&quot;, &quot;stderr_lines&quot;: [&quot;Error response from daemon: repository registry.cn-hangzhou.aliyuncs.com/google_containers/cluster-proportional-autoscaler-amd64 not found: does not exist or no pull access&quot;], &quot;stdout&quot;: &quot;&quot;, &quot;stdout_lines&quot;: []}
fatal: [node2]: FAILED! =&gt; {&quot;attempts&quot;: 4, &quot;changed&quot;: true, &quot;cmd&quot;: [&quot;/usr/bin/docker&quot;, &quot;pull&quot;, &quot;registry.cn-hangzhou.aliyuncs.com/google_containers/cluster-proportional-autoscaler-amd64:1.1.2&quot;], &quot;delta&quot;: &quot;0:00:00.390301&quot;, &quot;end&quot;: &quot;2018-02-08 18:03:46.246213&quot;, &quot;msg&quot;: &quot;non-zero return code&quot;, &quot;rc&quot;: 1, &quot;start&quot;: &quot;2018-02-08 18:03:45.855912&quot;, &quot;stderr&quot;: &quot;Error response from daemon: repository registry.cn-hangzhou.aliyuncs.com/google_containers/cluster-proportional-autoscaler-amd64 not found: does not exist or no pull access&quot;, &quot;stderr_lines&quot;: [&quot;Error response from daemon: repository registry.cn-hangzhou.aliyuncs.com/google_containers/cluster-proportional-autoscaler-amd64 not found: does not exist or no pull access&quot;], &quot;stdout&quot;: &quot;&quot;, &quot;stdout_lines&quot;: []}
</code></pre></div><p>è¯´æ˜è¿™ä¸ªé•œåƒåœ¨é˜¿é‡Œäº‘æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘æœ‰åœ¨ docker å®˜ç½‘æ‰¾äº†ä¸‹ï¼Œæœ‰ä¸€ä¸ªè¿™ä¸ªï¼š<code>mirrorgooglecontainers/cluster-proportional-autoscaler-amd64</code></p> <p>å»ºè®®ä½ å¯ä»¥æ‰¾ä¸ªæœ‰ docker çš„æœåŠ¡å™¨è¯•ä¸€ä¸‹ï¼š<code>docker pull mirrorgooglecontainers/cluster-proportional-autoscaler-amd64</code>ï¼Œå¦‚æœèƒ½ä¸‹è½½ï¼Œé‚£å°±è¯´æ˜æ²¡é—®é¢˜äº†ã€‚
åŒæ—¶ä¹Ÿå‘ç°è¿™ä¸ª docker hub ç”¨æˆ·æ˜¯åŒ—äº¬çš„ï¼Œåº”è¯¥åŒé“ã€‚</p> <p>ç„¶ååˆæŠ¥äº†ä¸‹é¢è¿™ä¸ªé”™è¯¯ã€‚ä¸»è¦æ˜¯è¿™ä¸ªè„šæœ¬ï¼š/usr/local/bin/etcd-scripts/make-ssl-etcd.sh æœ‰è¿™ä¸ªé”™è¯¯ï¼š$'\r': command not found
è€Œè¿™ä¸ªè„šæœ¬æ˜¯æ¥è‡ªæ“ä½œæœºä¸Šçš„ /opt/kubespray/roles/etcd/files ç›®å½•</p> <div class="language- extra-class"><pre class="language-text"><code>fatal: [node1 -&gt; 172.20.229.225]: FAILED! =&gt; {&quot;changed&quot;: true, &quot;cmd&quot;: [&quot;bash&quot;, &quot;-x&quot;, &quot;/usr/local/bin/etcd-scripts/make-ssl-etcd.sh&quot;, &quot;-f&quot;, &quot;/etc/ssl/etcd/openssl.conf&quot;, &quot;-d&quot;, &quot;/etc/ssl/etcd/ssl&quot;], &quot;delta&quot;: &quot;0:00:00.012822&quot;, &quot;end&quot;: &quot;2018-02-08 18:42:09.815776&quot;, &quot;msg&quot;: &quot;non-zero return code&quot;, &quot;rc&quot;: 2, &quot;start&quot;: &quot;2018-02-08 18:42:09.802954&quot;, &quot;stderr&quot;: &quot;+ $'\\r'\n/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 2: $'\\r': command not found\n+ $'\\r'\n/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 16: $'\\r': command not found\n+ set -o $'errexit\\r'\n/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 17: set: errexit\r: invalid option name\n+ set -o $'pipefail\\r'\n/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 18: set: pipefail\r: invalid option name\n/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 19: syntax error near unexpected token `$'\\r''\n/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 19: `usage()\r'&quot;, &quot;stderr_lines&quot;: [&quot;+ $'\\r'&quot;, &quot;/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 2: $'\\r': command not found&quot;, &quot;+ $'\\r'&quot;, &quot;/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 16: $'\\r': command not found&quot;, &quot;+ set -o $'errexit\\r'&quot;, &quot;/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 17: set: errexit&quot;, &quot;: invalid option name&quot;, &quot;+ set -o $'pipefail\\r'&quot;, &quot;/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 18: set: pipefail&quot;, &quot;: invalid option name&quot;, &quot;/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 19: syntax error near unexpected token `$'\\r''&quot;, &quot;/usr/local/bin/etcd-scripts/make-ssl-etcd.sh: line 19: `usage()&quot;, &quot;'&quot;], &quot;stdout&quot;: &quot;&quot;, &quot;stdout_lines&quot;: []}
</code></pre></div><p>æˆ‘ä»¬éœ€è¦æ“ä½œè¿™ä¸ªæœºèŠ‚ç‚¹åšè¿™æ ·çš„æ“ä½œï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y dos2unix unix2dos

cd /opt/kubespray/roles/etcd/files &amp;&amp; dos2unix make-ssl-etcd.sh
cd /opt/kubespray/roles/kubernetes/secrets/files &amp;&amp; dos2unix make-ssl.sh
</code></pre></div><h4 id="éªŒè¯"><a href="#éªŒè¯" class="header-anchor">#</a> éªŒè¯</h4> <p>SSH è¿ä¸Š master èŠ‚ç‚¹ï¼šssh root@172.20.229.225
è¾“å…¥ï¼š<code>kubectl get nodes</code></p> <p>å±•ç¤ºå‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š
NAME      STATUS                     AGE       VERSION
node1     Ready,SchedulingDisabled   1m        v1.6.1+coreos.0
node2     Ready                      1m        v1.6.1+coreos.0
node3     Ready                      1m        v1.6.1+coreos.0</p> <h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="header-anchor">#</a> èµ„æ–™</h2> <ul><li><a href="http://www.wisely.top/2017/05/16/kargo-ansible-kubernetes/" target="_blank" rel="noopener noreferrer">http://www.wisely.top/2017/05/16/kargo-ansible-kubernetes/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/wiselyman/kubespray" target="_blank" rel="noopener noreferrer">https://github.com/wiselyman/kubespray<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>&lt;&gt;
======================================================</li></ul> <p>å®‰è£…bzip2è½¯ä»¶</p> <p>yum install -y bzip2</p> <p>tar -xjvf k8s_images.tar.bz2</p> <p>è®¾ç½® hostname</p> <p>hostnamectl --static set-hostname  k8s-master</p> <p>hostnamectl --static set-hostname  k8s-node-1</p> <p>åœ¨masterå’Œslaveçš„/etc/hostsæ–‡ä»¶ä¸­å‡åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š</p> <p>172.18.218.96   k8s-master
172.18.218.96   etcd
172.18.218.96   registry
172.18.218.97   k8s-node-1</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/adminlove520/Linux_All_in_one/edit/main/docs/docker/Kubernetes-Install-And-Usage.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢ï¼</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">3 hours ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/Linux_All_in_one/assets/js/app.4a61619a.js" defer></script><script src="/Linux_All_in_one/assets/js/2.ee3c5eb7.js" defer></script><script src="/Linux_All_in_one/assets/js/1.bc260717.js" defer></script><script src="/Linux_All_in_one/assets/js/37.c49eb234.js" defer></script><script src="/Linux_All_in_one/assets/js/21.f8578145.js" defer></script>
  </body>
</html>

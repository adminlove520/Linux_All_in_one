(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{386:function(s,t,a){"use strict";a.r(t);var e=a(9),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" Docker Compose")]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://github.com/docker/compose",target:"_blank",rel:"noopener noreferrer"}},[s._v("compose"),t("OutboundLink")],1),s._v(" 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。从功能上看，跟 "),t("code",[s._v("OpenStack")]),s._v(" 中的 "),t("code",[s._v("Heat")]),s._v(" 十分类似。")])]),s._v(" "),t("h2",{attrs:{id:"一、compose-简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、compose-简介"}},[s._v("#")]),s._v(" 一、Compose 简介")]),s._v(" "),t("p",[t("strong",[t("code",[s._v("Compose")]),s._v(" 的定位是：定义和运行多个 Docker 容器的应用")]),s._v("。 使用一个 "),t("code",[s._v("Dockerfile")]),s._v(" 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。")]),s._v(" "),t("p",[t("code",[s._v("Compose")]),s._v(" 恰好满足了这样的需求。它允许用户通过一个单独的 "),t("code",[s._v("docker-compose.yml")]),s._v(" 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。")]),s._v(" "),t("p",[t("code",[s._v("Compose")]),s._v(" 中有两个重要的概念：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("服务 ("),t("code",[s._v("service")]),s._v(")")]),s._v("：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。")]),s._v(" "),t("li",[t("strong",[s._v("项目 ("),t("code",[s._v("project")]),s._v(")")]),s._v("：由一组关联的应用容器组成的一个完整业务单元，在 "),t("code",[s._v("docker-compose.yml")]),s._v(" 文件中定义。")])]),s._v(" "),t("p",[t("code",[s._v("Compose")]),s._v(" 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。")]),s._v(" "),t("h2",{attrs:{id:"二、安装卸载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、安装卸载"}},[s._v("#")]),s._v(" 二、安装卸载")]),s._v(" "),t("p",[t("code",[s._v("Compose")]),s._v(" 支持 Linux、macOS、Windows10 三大平台。")]),s._v(" "),t("p",[s._v("Linux 安装方式：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" https://github.com/docker/compose/releases/download/1.24.1/docker-compose-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /usr/local/bin/docker-compose\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/docker-compose\n")])])]),t("blockquote",[t("p",[s._v("🔔 详情请参考："),t("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Install Docker Compose"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"三、快速入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、快速入门"}},[s._v("#")]),s._v(" 三、快速入门")]),s._v(" "),t("h3",{attrs:{id:"web-应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-应用"}},[s._v("#")]),s._v(" web 应用")]),s._v(" "),t("p",[s._v("新建文件夹，在该目录中编写 "),t("code",[s._v("app.py")]),s._v(" 文件")]),s._v(" "),t("div",{staticClass:"language-python extra-class"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" flask "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Flask\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" redis "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Redis\n\napp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Flask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__name__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nredis "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("incr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hits'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello World! 该页面已被访问 {} 次。\\n'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__main__"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" debug"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),t("p",[s._v("编写 "),t("code",[s._v("Dockerfile")]),s._v(" 文件，内容为")]),s._v(" "),t("div",{staticClass:"language-docker extra-class"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" python:3.6-alpine")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" . /code")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /code")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pip install redis flask")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.py"')]),s._v("]")]),s._v("\n")])])]),t("h3",{attrs:{id:"docker-compose-yml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml"}},[s._v("#")]),s._v(" docker-compose.yml")]),s._v(" "),t("p",[s._v("编写 "),t("code",[s._v("docker-compose.yml")]),s._v(" 文件，这个是 Compose 使用的主模板文件。")]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5000:5000"')]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis:alpine"')]),s._v("\n")])])]),t("h3",{attrs:{id:"运行-compose-项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行-compose-项目"}},[s._v("#")]),s._v(" 运行 compose 项目")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up\n")])])]),t("p",[s._v("此时访问本地 "),t("code",[s._v("5000")]),s._v(" 端口，每次刷新页面，计数就会加 1。")]),s._v(" "),t("h2",{attrs:{id:"四、命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、命令"}},[s._v("#")]),s._v(" 四、命令")]),s._v(" "),t("blockquote",[t("p",[s._v("🔔 请参考：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/compose/reference/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Compose 官方命令说明文档"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://yeasy.gitbooks.io/docker_practice/content/compose/commands.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Compose 命令说明中文文档"),t("OutboundLink")],1)])])]),s._v(" "),t("h2",{attrs:{id:"五、模板文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五、模板文件"}},[s._v("#")]),s._v(" 五、模板文件")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("docker-compose.yml")]),s._v(" 文件是 Docker Compose 的模板文件，其作用类似于 Dockerfile 和 Docker。")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.docker.com/compose/env-file/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker-compose.yml 支持的默认环境变量官方文档"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("官方")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/docker/compose",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker Compose Github"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/compose/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker Compose 官方文档"),t("OutboundLink")],1)])])]),s._v(" "),t("li",[t("strong",[s._v("教程")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://yeasy.gitbooks.io/docker_practice/content/compose/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker — 从入门到实践 - Docker Compose 项目"),t("OutboundLink")],1)])])])])])}),[],!1,null,null,null);t.default=r.exports}}]);